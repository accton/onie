# -*- shell-script -*-

# Demonstration of the init-platform functionality

# This script fragment is sourced by /etc/init.d/init-arch.sh, which
# in turn executes the init_platform_pre_arch() and
# init_platform_post_arch() functions.

# A machine can use this feature to run any early boot scripts needed
# by the machine.  A typical usage would be to initialize specific
# hardware devices.

# Use this function to perform any initializations required by the
# architecture specific initialization.  This function executes before
# the architecture initializations.
init_platform_pre_arch()
{
    i2cset -y 0 0x76 0 0x4 >/dev/null 2>&1
    # set temperature values of CPU and switch ASIC to 0 that fan will be
    # controlled by machine itself
    i2cset -y 0 0x60 0x30 0x0 >/dev/null 2>&1
    i2cset -y 0 0x60 0x31 0x0 >/dev/null 2>&1
    i2cset -y 0 0x76 0 0 >/dev/null 2>&1

    chassisinfo_lib="/lib/onie/chassisinfo-platform"
    if [ -r "$chassisinfo_lib" ] ; then
        . $chassisinfo_lib
        accton_chassisinfo_load
        sed -i -e "s/accton_omp800/${ACCTON_CHASSIS_MACHINE}/g" /etc/machine.conf
        log_info_msg "Platform   : $(onie-sysinfo -p)"
        log_info_msg "Card Type  : $ACCTON_CHASSIS_CARD"
        log_info_msg "Subchassis : $ACCTON_CHASSIS_SUB"
        log_info_msg "Slot Id    : $ACCTON_CHASSIS_SLOT"
        log_info_msg "Cpu Id     : $ACCTON_CHASSIS_CPU"
    else
        echo "ERROR: $chassisinfo_lib file is missing."
    fi
}
